<!DOCTYPE html>
<html>

<head>
  <meta http-equiv="Content-type" content="text/html; charset=utf-8">
  <title>Derivador porcentual</title>

  <!--importo scheduler-->
  <script src="../codebase/dhtmlxscheduler.js" type="text/javascript" charset="utf-8"></script>
  <link rel="stylesheet" href="../codebase/dhtmlxscheduler.css" type="text/css" charset="utf-8">



  <!--importo bootstrap-4 y jquery 3.2-->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
  <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>

  <!--importo diferentes clases de scheduler-->

  <script src="../codebase/ext/dhtmlxscheduler_key_nav.js" type="text/javascript" charset="utf-8"></script>
  <!--<script src="../codebase/ext/dhtmlxscheduler_recurring.js" type="text/javascript" charset="utf-8"></script>-->
  <script src="../codebase/ext/dhtmlxscheduler_quick_info.js" type="text/javascript" charset="utf-8"></script>
  <script src="../codebase/ext/dhtmlxscheduler_collision.js" type="text/javascript" charset="utf-8"></script>
  <script src="../codebase/ext/dhtmlxscheduler_serialize.js" type="text/javascript" charset="utf-8"></script>
  <script src="../codebase/ext/dhtmlxscheduler_pdf.js" type="text/javascript" charset="utf-8"></script>
  <script src="../codebase/ext/dhtmlxscheduler_minical.js" type="text/javascript" charset="utf-8"></script>
  <script src="../codebase/ext/dhtmlxscheduler_units.js" type="text/javascript" charset="utf-8"></script>
  <script src="../codebase/ext/dhtmlxscheduler_year_view.js" type="text/javascript" charset="utf-8"></script>
  <script src='../codebase/ext/dhtmlxscheduler_timeline.js' type="text/javascript" charset="utf-8"></script>
  <script src='../codebase/ext/dhtmlxscheduler_tooltip.js' type="text/javascript" charset="utf-8"></script>
  <script src="../codebase/ext/dhtmlxscheduler_multiselect.js" type="text/javascript" charset="utf-8"></script>

  <!--importo dhtxmlsuite-->
  <link rel="stylesheet" href="http://cdn.dhtmlx.com/edge/dhtmlx.css" type="text/css">
  <script src="http://cdn.dhtmlx.com/edge/dhtmlx.js" type="text/javascript"></script>


  <style type="text/css">

    html, body {
      margin: 7%;
      margin-left: 15%;
      padding: 0px;
      height: 400px;
      width: 950px;
      overflow: visible;
    }

    .dhx_cal_event div.dhx_footer,
    .dhx_cal_event.past_event div.dhx_footer,
    .dhx_cal_event.event_rosa div.dhx_footer,
    .dhx_cal_event.event_naranja div.dhx_footer,
    .dhx_cal_event.event_verde div.dhx_footer {
      background-color: transparent !important;
    }

    .dhx_cal_event .dhx_body {
      -webkit-transition: opacity 0.1s;
      transition: opacity 0.1s;
      opacity: 0.7;
    }

    .dhx_cal_event .dhx_title {
      line-height: 12px;
    }

    .dhx_cal_event_line:hover,
    .dhx_cal_event:hover .dhx_body,
    .dhx_cal_event.selected .dhx_body,
    .dhx_cal_event.dhx_cal_select_menu .dhx_body {
      opacity: 1;
    }


    /*color de los eventos naranjas*/

    .dhx_cal_event.event_naranja div,
    .dhx_cal_event_line.event_naranja {
      background-color: orange !important;
      border-color: black !important;
    }

    .dhx_cal_event_clear.event_naranja {
      color: orange !important;
    }

    /*color de los eventos rojos*/

    .dhx_cal_event.event_rojo div,
    .dhx_cal_event_line.event_rojo {
      background-color: red !important;
      border-color: black !important;
    }

    .dhx_cal_event_clear.event_rojo {
      color: red !important;
    }

    /*color de los eventos verdes*/

    .dhx_cal_event.event_verde div,
    .dhx_cal_event_line.event_verde {
      background-color: #36BD14 !important;
      border-color: black !important;
    }

    .dhx_cal_event_clear.event_verde {
      color: #36BD14 !important;
    }

    /*color de los eventos rosa*/

    .dhx_cal_event.event_rosa div,
    .dhx_cal_event_line.event_rosa {
      background-color: #FC5BD5 !important;
      border-color: black !important;
    }

    .dhx_cal_event_clear.event_rosa {
      color: #B82594 !important;
    }

    /*color de los eventos negros*/

    .dhx_cal_event.event_negro div,
    .dhx_cal_event_line.event_negro {
      background-color: #404040 !important;
      border-color: black !important;
    }

    .dhx_cal_event_clear.event_negro {
      color: #404040 !important;
    }

    /*color de los eventos azules*/

    .dhx_cal_event.event_azul div,
    .dhx_cal_event_line.event_azul {
      background-color: #0040ff !important;
      border-color: black !important;
    }

    .dhx_cal_event_clear.event_azul {
      color: #0040ff !important;
    }

    /*color de los eventos morados*/

    .dhx_cal_event.event_morado div,
    .dhx_cal_event_line.event_morado {
      background-color: #AF7AC5 !important;
      border-color: black !important;
    }

    .dhx_cal_event_clear.event_morado {
      color: black !important;
    }


    /*color de los eventos celestes*/

    .dhx_cal_event.event_celeste div,
    .dhx_cal_event_line.event_celeste {
      background-color: #76D7C4 !important;
      border-color: black !important;
    }

    .dhx_cal_event_clear.event_celeste {
      color: black !important;
    }

    /*color de los eventos cafe*/

    .dhx_cal_event.event_cafe div,
    .dhx_cal_event_line.event_cafe {
      background-color: #8B4513 !important;
      border-color: black !important;
    }

    .dhx_cal_event_clear.event_cafe {
      color: black !important;
    }

    /*color de los eventos amarillo*/

    .dhx_cal_event.event_amarillo div,
    .dhx_cal_event_line.event_amarillo {
      background-color: #d0c800 !important;
      border-color: black !important;
    }

    .dhx_cal_event_clear.event_amarillo {
      color: black !important;
    }
  </style>
  <!--se inicializa el script-->
  <script type="text/javascript" charset="utf-8">

    //Configuracion scheduler
    scheduler.locale.labels.timeline_tab = "Timeline";
    scheduler.config.xml_date = "%Y-%m-%d %H:%i";
    scheduler.config.time_step = 60;
    scheduler.config.multi_day = true;
    scheduler.config.multisection = true;
    scheduler.locale.labels.section_colores = "colores";
    scheduler.locale.labels.section_id_tramo = "id_tramo";
    scheduler.locale.labels.section_id_horario = "id_horario";
    scheduler.config.first_hour = 06;
    scheduler.config.last_hour = 24;
    scheduler.config.limit_time_select = true;
    scheduler.config.details_on_dblclick = true;
    scheduler.config.details_on_create = true;
    scheduler.config.repeat_precise = true;
    scheduler.config.include_end_by = true;
    scheduler.config.occurrence_timestamp_in_utc = true;
    scheduler.config.touch = "force";
    scheduler.config.repeat_date = "%m/%d/%Y";
    scheduler.config.include_end_by = true;
    scheduler.locale.labels.unit_tab = "Feriados";
    scheduler.config.repeat_precise = true;

    //colecion tramos horarios

    var id_tramo = [{  key: 0, label: 'Habil-AM'}
                   ,{  key: 1, label: 'Nocturno'}
                   ,{  key: 2, label: 'Habil-Madrugada'}
                   ,{  key: 3, label: 'nohabil-X'}
                   ,{  key: 4, label: 'nohabil-Y'}
                   ,{  key: 5, label: 'habil-pm'}
                   ,{  key: 6, label: 'Libre'} ];

   var desc_tramo= ["Horario Habil Am"
                    ,"Horario Nocturno"
                    ,"Horario Habil Madrugada"
                    ,"Horario No Habil X"
                    ,"Horario No Habil Y"
                    ,"Horario Habil PM"
                    ,"Horario Libre"];

    //coleccion de colores
    var colores = [{ key: 0, label: 'azul'}
                  ,{ key: 1, label: 'rosa' }
                  ,{ key: 2, label: 'Naranja'}
                  ,{ key: 3, label: 'verde'}
                  ,{ key: 4, label: 'rojo' }
                  ,{ key: 5, label: 'negro'}
                  ,{ key: 6, label: 'morado'}
                  ,{ key: 7, label: 'celeste'}
                  ,{ key: 8, label: 'cafe'}
                  ,{ key: 9, label: 'amarillo'}];



    //coleccion de tipos de  feriados
    //falta dar tratamiento a los feriados
    var sections = [{ key: 0, label: "Feriado Empresa"}
                   ,{ key: 1, label: "Feriado nacional"}
                   ,{ key: 2, label: "Feriado regional"}
                   ,{ key: 3, label: "feriado x"}];

    //coloeccion Horario
    var horario = [{ key: 0, label: "Ventas"}
                  ,{ key: 1, label: "soporte"}
                  ,{ key: 2, label: "bloqueos"}];




    /*arreglo de dias que posteriormente se utilizará para mostrar el
    dia en el que sucede un evento*/

    var dias = ["domingo", "lunes", "martes", "miercoles", "jueves", "viernes", "sabado"];

    //arreglo tramo horario y detalle tramo
    var tramo_horario = [];
    var detalle_tramo = []; // 1 Event de la grilla Schedule.
    var arreglo_eventos = [];
    var id_eventos = [];
    var detalletramo2 = [];
    var datos_select=[];
        //obtengo el dia actual
        var dt = new Date();
        var mes = dt.getMonth();
        var dia = dt.getDate();
        var año = dt.getFullYear();
    // FALTA: ir a la BD y obtener los valores para "llenar" tramo_horario y detalle_tramo_horario

    // 1 Tramo:
    var tramo = {
      id_tramo: 1,
      descripcion_tramo: desc_tramo[1],
      color: 5
    };
    tramo_horario.push(tramo);

    // 2 Tramo:
    tramo = {
      id_tramo: 2,
      descripcion_tramo: desc_tramo[2],
      color: 1
    };
    tramo_horario.push(tramo);

    //3 tramo
    tramo = {
      id_tramo: 3,
      descripcion_tramo: desc_tramo[3],
      color: 2
    };
    tramo_horario.push(tramo);

    //4 tramo
    tramo = {
      id_tramo: 4,
      descripcion_tramo: desc_tramo[4],
      color: 3
    };
    tramo_horario.push(tramo);

    //5 tramo
    tramo = {
      id_tramo: 5,
      descripcion_tramo: desc_tramo[5],
      color: 4
    };
    tramo_horario.push(tramo);


    //detalle tramo 1
    var detalle = {
      id_detalle_tramo: "2",
      id_tramo: 1,
      descripcion_detalle: "Lunes",
      fecha_y_hora_inicio: "2018-02-19 13:00",
      fecha_y_hora_termino: "2018-02-19 18:00"
    };
    detalle_tramo.push(detalle);

    //detalle 2 tramo 1
    detalle = {
      id_detalle_tramo: "3",
      id_tramo: 1,
      descripcion_detalle: "Martes",
      fecha_y_hora_inicio: "2018-02-20 13:00",
      fecha_y_hora_termino: "2018-02-20 18:00"
    };
    detalle_tramo.push(detalle);

    //detalle 3 tramo 1
    detalle = {
      id_detalle_tramo: "4",
      id_tramo: 1,
      descripcion_detalle: "Miercoles",
      fecha_y_hora_inicio: "2018-02-21 13:00",
      fecha_y_hora_termino: "2018-02-21 18:00"
    };
    detalle_tramo.push(detalle);

    detalle = {
      id_detalle_tramo: "10",
      id_tramo: 1,
      descripcion_detalle: "Jueves",
      fecha_y_hora_inicio: "2018-02-22 08:00",
      fecha_y_hora_termino: "2018-02-22 23:00"
    };
    detalle_tramo.push(detalle);
    //detalle tramo 2
    detalle = {
      id_detalle_tramo: "5",
      id_tramo: 2,
      descripcion_detalle: "Sabado",
      fecha_y_hora_inicio: "2018-02-24 07:00",
      fecha_y_hora_termino: "2018-02-24 23:00"
    };
    detalle_tramo.push(detalle);

    //detalle 2 tramo 2
    detalle = {
      id_detalle_tramo: "6",
      id_tramo: 2,
      descripcion_detalle: "Domingo",
      fecha_y_hora_inicio: "2018-02-25 08:00",
      fecha_y_hora_termino: "2018-02-25 14:00"
    };
    detalle_tramo.push(detalle);

    //detalle  tramo 3
    detalle = {
      id_detalle_tramo: "7",
      id_tramo: 3,
      descripcion_detalle: "Lunes",
      fecha_y_hora_inicio: "2018-02-19 11:00",
      fecha_y_hora_termino: "2018-02-19 12:00"
    };
    detalle_tramo.push(detalle);

    //detalle  tramo 4
    detalle = {
      id_detalle_tramo: "8",
      id_tramo: 3,
      descripcion_detalle: "martes",
      fecha_y_hora_inicio: "2018-02-20 11:00",
      fecha_y_hora_termino: "2018-02-20 12:00"
    };
    detalle_tramo.push(detalle);

    //detalle  tramo 5
    detalle = {
      id_detalle_tramo: "9",
      id_tramo: 5,
      descripcion_detalle: "miercoles",
      fecha_y_hora_inicio: "2018-02-21 06:00",
      fecha_y_hora_termino: "2018-02-21 11:00"
    };
    detalle_tramo.push(detalle);

    //detalle 2  tramo 5
    detalle = {
      id_detalle_tramo: "10",
      id_tramo: 5,
      descripcion_detalle: "lunes",
      fecha_y_hora_inicio: "2018-02-19 06:00",
      fecha_y_hora_termino: "2018-02-19 10:00"
    };
    detalle_tramo.push(detalle);

    // se agregan horarios para otro grupo de grupodistribucion
    var detalle = {
      id_detalle_tramo: "2",
      id_tramo: 2,
      descripcion_detalle: "Lunes",
      fecha_y_hora_inicio: "2018-02-19 06:00",
      fecha_y_hora_termino: "2018-02-19 08:00"
    };
    detalletramo2.push(detalle);

    //detalle 2 tramo 1
    detalle = {
      id_detalle_tramo: "3",
      id_tramo: 4,
      descripcion_detalle: "Martes",
      fecha_y_hora_inicio: "2018-02-20 06:00",
      fecha_y_hora_termino: "2018-02-20 08:00"
    };
    detalletramo2.push(detalle);

    //detalle 3 tramo 1
    detalle = {
      id_detalle_tramo: "4",
      id_tramo: 5,
      descripcion_detalle: "Miercoles",
      fecha_y_hora_inicio: "2018-02-21 06:00",
      fecha_y_hora_termino: "2018-02-21 08:00"
    };
    detalletramo2.push(detalle);


    scheduler.createUnitsView({
      name: "unit",
      property: "section_id",
      list: sections
    });

    //se crea la linea de tiempo
    scheduler.createTimelineView({
      name: "timeline",
      x_unit: "minute",
      x_date: "%H:%i",
      x_step: 30,
      x_size: 24,
      x_start: 16,
      x_length: 48,
      y_unit: sections,
      y_property: "section_id",
      render: "bar"
    });


    //al cambiar tramo horario cambia automaticamente el select de color al que corresponda al tramo.
    var parent_onchange = function(event) {
      var colordetramo;

      for (var i = 0; i < tramo_horario.length; i++) {
        if (scheduler.formSection('id_tramo').getValue() == tramo_horario[i].id_tramo) {
          colordetramo = tramo_horario[i].color;
        }
      }
      scheduler.formSection('Color').setValue(colordetramo);
    };


    //se cargan secciones del lightbox
    scheduler.config.lightbox.sections = [{
        name: "id_tramo",
        height: 20,
        type: "select",
        options: id_tramo,
        map_to: "id_tramo",
        onchange: parent_onchange
      },
      {
        name: "descripcion",
        height: 43,
        map_to: "text",
        type: "textarea",
        focus: true
      },
      {
        name: "Color",
        height: 20,
        type: "select",
        options: colores,
        map_to: "colores"
      },
      {
        name: "Tiempo",
        height: 72,
        type: "time",
        map_to: "auto"
      }
    ];


    function carga() {
      for (var i = 0; i < tramo_horario.length; i++) {

        for (var x = 0; x < detalle_tramo.length; x++) {

          if (detalle_tramo[x].id_tramo == tramo_horario[i].id_tramo) {

            var auxiliarsubindice= tramo_horario[i].descripcion_tramo;

            scheduler.parse([{
              start_date: detalle_tramo[x].fecha_y_hora_inicio,
              end_date: detalle_tramo[x].fecha_y_hora_termino,
              text: tramo_horario[i].descripcion_tramo,
              colores: tramo_horario[i].color,
              id_tramo: detalle_tramo[x].id_tramo
            }], "json");
          console.log(id_tramo[i].label);
            /*console.log("evento" + [i]);
            console.log("fecha inicio" + detalle_tramo[x].fecha_y_hora_inicio);
            console.log("fecha termino" + detalle_tramo[x].fecha_y_hora_termino);
            console.log("descripcion tramo" + tramo_horario[i].descripcion_tramo);
            console.log("color" + tramo_horario[i].color);*/

          }

        }
      }
      arreglo_eventos = scheduler.getEvents();

      for (var i = 0; i < arreglo_eventos.length; i++) {

        id_eventos.push(arreglo_eventos[i].id);
        detalle_tramo[i].id_detalle_tramo = arreglo_eventos[i].id;
      }
    } //fin funcion carga

    function carga2() {

      scheduler.parse([{
        start_date: "2018-02-19 06:00",
        end_date: "2018-02-19 08:00",
        text: id_tramo[2].label,
        colores: 1,
        id_tramo: 2
      }
      ,{
        start_date: "2018-02-20 06:00",
        end_date: "2018-02-20 10:00",
        text: id_tramo[1].label,
        colores: 5,
        id_tramo: 1
      }
    ], "json");
    }// fin carga2


    //funcion init aqui se establecen todas las configuraciones iniciales de scheduler
    function init() {




       scheduler.xy.scale_height = 20;
       scheduler.xy.bar_height = 10;


      //se inicia scheduler en el dia actual y se carga en la vista week
      scheduler.init('scheduler_here', new Date(año, mes, dia), "week");

      //colorea los eventos de acuerdo al color seleccionado al crearlos.
      scheduler.templates.event_class = CambiaColor;

      //copia un evento
      scheduler.attachEvent("onEventCopied", Copiar);

      //corta un evento
      scheduler.attachEvent("onEventCut", Cortar);

      //pega un evento
      scheduler.attachEvent( "onEventPasted", Pegar);

      //carga elementos en arreglos de objetos tramo_horario y detalle_tramo y dibuja los eventos
      scheduler.attachEvent("onEventAdded", AñadeEvento);

      /*la funcion onEventChanged se gatilla al editar un evento(cuadro de color),
      se le debe pasar el id del evento y el ev que es el objeto del evento en sí*/
      scheduler.attachEvent("onEventChanged", EditaEvento);


      SelecionGrupoDist();



    } //FIN FUNCION INIT


//llama a la funcion para cargar los distintos grupos de distribucion en scheduler
    function SelecionGrupoDist(){
          var select = document.getElementById('seleccionhorario');
          select.addEventListener('change',
            function() {
              var OpcionSeleccionada = this.options[select.selectedIndex];

              if (OpcionSeleccionada.value == "vt") {
                // scheduler.clearAll();
                loadDataVentas();
                carga(tramo_horario, detalle_tramo);

              } else if (OpcionSeleccionada.value == "sp") {
                // scheduler.clearAll();
                // carga2();
                loadDataSoporte();
                carga(tramo_horario, detalle_tramo);
              } else if (OpcionSeleccionada.value == "bq") {
                scheduler.clearAll();
              }
              console.log(OpcionSeleccionada.value + ': ' + OpcionSeleccionada.text);
            });

    }



    function CambiaColor(start, end, event) {

      var css = "";

      if (event.colores) {

        for (var i = 0; i < colores.length; i++) {
          if (event.colores == colores[i].key) {
            css += "event_" + colores[i].label.toLowerCase();
            idrosas = event.colores;
          }

        }
      }

      if (event.id == scheduler.getState().select_id) {
        css += " selected";
      }
      return css;
    }; //fin funcion cambia color



    function Copiar(ev) {

      dhtmlx.message("Has copiado un horario: <br/><b>" + ev.text + "</b>");
      modified_event_id = ev.id;
      scheduler.updateEvent(ev.id);
    } //fin funcion Copiar


    function Cortar(ev) {
      dhtmlx.message("Cortaste un horario: <br/><b>" + ev.text + "</b>");
      modified_event_id = ev.id;
      scheduler.updateEvent(ev.id);
    } // fin funcion cortar


    function Pegar(isCopy, modified_ev, original_ev) {
      modified_event_id = null;
      scheduler.updateEvent(modified_ev.id);
      var evs = scheduler.getEvents(modified_ev.start_date, modified_ev.end_date);
      if (evs.length > 1) {
        dhtmlx.modalbox({
          text: "Hay otro horario en este mismo tramo , que desea hacer?",
          width: "500px",
          position: "middle",
          buttons: ["revertir cambios", "Editar evento", "guardar cambios"],
          callback: function(index) {

            switch (+index) {
              case 0:
                if (isCopy) {
                  // copy operation, need to delete new event
                  scheduler.deleteEvent(modified_ev.id);

                } else {
                  // cut operation, need to restore dates
                  modified_ev.start_date = original_ev.start_date;
                  modified_ev.end_date = original_ev.end_date;
                  scheduler.setCurrentView();
                }
                break;
              case 1:

                scheduler.showLightbox(modified_ev.id);

                break;
              case 2:
                return;
            }
          }
        });
      }
    } //fin funcion pegar


    function AñadeEvento(id, ev) {
      var encontrado = false;

      tramo = {
        id_tramo: ev.id_tramo,
        descripcion_tramo: desc_tramo[ev.id_tramo],
        color: ev.colores
      };

      detalle = {
        id_detalle_tramo: id,
        id_tramo: scheduler.getEvent(id).id_tramo,
        descripcion_detalle: dias[ev.start_date.getDay()],
        fecha_y_hora_inicio: scheduler.getEvent(id).start_date,
        fecha_y_hora_termino:scheduler.getEvent(id).end_date
      };




      for (var i = 0; i < tramo_horario.length; i++) {
        //  if (detalle.id_tramo==tramo_horario[i].id_tramo ){

        if (tramo.id_tramo == tramo_horario[i].id_tramo) {
          ev.colores = tramo_horario[i].color;
          scheduler.updateEvent(id);

          encontrado = true;

        }

      }

      if (encontrado==false) {
        tramo_horario.push(tramo);
        detalle_tramo.push(detalle);

      } else {
        detalle_tramo.push(detalle);
      }
      id_eventos.push(ev.id);
      ev.text =tramo.descripcion_tramo;
      console.log(ev.text);


    }

    function EditaEvento(id, ev) {

      var coloraux;

      //se insertan los datos dados por el usuario en el objeto.
      tramo = {
        id_tramo: ev.id_tramo,
        descripcion_tramo: desc_tramo[ev.id_tramo],
        color: ev.colores
      };

       ev.text=desc_tramo[ev.id_tramo];

      detalle = {
        id_detalle_tramo: id,
        id_tramo: ev.id_tramo,
        descripcion_detalle: dias[ev.start_date.getDay()],
        fecha_y_hora_inicio: ev.start_date,
        fecha_y_hora_termino: ev.end_date
      };

     ev.text
      for (var i = 0; i < detalle_tramo.length; i++) {
        for (var x = 0; x < tramo_horario.length; x++) {
          if (id == detalle_tramo[i].id_detalle_tramo) {
            detalle_tramo[i].id_tramo = detalle.id_tramo;
            if (tramo_horario[x].id_tramo == detalle_tramo[i].id_tramo) {
              coloraux = ev.colores;
              ev.colores = tramo_horario[x].color;

              scheduler.updateEvent(id);
            }
            if (tramo_horario[x].id_tramo == ev.id_tramo) {
              tramo_horario[x].color = coloraux;

              scheduler.updateEvent(id);
            }
          }
        }
      }
  console.log("se actualizan todos los eventos");

      for (var i = 0; i < id_eventos.length; i++){
        if (ev.id_tramo == detalle_tramo[i].id_tramo){

          scheduler.getEvent(id_eventos[i]).colores = coloraux;

          for (var x = 0; x < tramo_horario.length; x++) {
            if (coloraux == tramo_horario[x].color) {

              scheduler.updateEvent(id_eventos[i]);
              console.log("evento: " + detalle_tramo[i].id_detalle_tramo + "actualizado");

            }
          }
        }
      }

      for (var i = 0; i < detalle_tramo.length; i++) {
        if (detalle_tramo[i].id_detalle_tramo == id) {
          detalle_tramo[i].fecha_y_hora_inicio = detalle.fecha_y_hora_inicio;
          detalle_tramo[i].fecha_y_hora_termino = detalle.fecha_y_hora_termino;
        }
      }


      for (var i = 0; i < detalle_tramo.length; i++) {
        console.log(detalle_tramo[i].descripcion_detalle);
      }

    } //fin funcion EditaEvento

function llenaselect(){

var select = document.getElementById("seleccionhorario");
var dato_agregar=document.getElementById("input_nombre_horario").value;
   datos_select.push(e);

  var option= document.createElement("option");
  option.innerHTML= document.getElementById("input_nombre_horario").value;
  select.appendChild(option);
}
function vaciaselect(borra){

var select = document.getElementById("seleccionhorario");

var i = borra.parentNode.firstChild.text;

//$("#campo_select_").find().remove();

alert(i);


}


function myCreateFunction()
{
var table = document.getElementById("tablagrupodist");

  var largo=table.rows.length;

  var row = table.insertRow(largo);
  var cell1 = row.insertCell(0);
  var cell2 = row.insertCell(1);
  var cell3 = row.insertCell(2);
  var nombregrup=document.getElementById("input_nombre_horario").value;
  var detallegrup=document.getElementById("input_detalle_horario").value;
  cell1.innerHTML = nombregrup;
  cell2.innerHTML = detallegrup;
  cell3.innerHTML = '<button type="button" class="btn btn-danger" id="borragrupodist" onClick="myDeleteFunction(this); vaciaselect(this);">Borrar</button>';
   llenaselect();
  document.getElementById("input_nombre_horario").value="";
  document.getElementById("input_detalle_horario").value= "";


}
function myDeleteFunction(borra)
{
var i = borra.parentNode.parentNode.rowIndex;
document.getElementById("tablagrupodist").deleteRow(i);

}
  </script>
</head>

<body onload="init();">

  <div class="dhx_body">
    <div class="row">
      <div class="col-md-2">
        <button class="btn btn-primary " type="button" id="btnhorario" data-target="#agregagrupodistri" data-toggle="modal" aria-haspopup="true" aria-expanded="false">
          Grupos distribucion
      </button>
      </div>

      <div class="col-md-3">
        <select name="grupodistribucion" id="seleccionhorario">
    <option value="" disabled selected>Seleccione grupo de distribucion</option>
  	<option value="vt">Ventas</option>
  	<option value="sp">Soporte</option>
  	<option value="bq">Bloqueos</option>

  </select>
      </div>


      <div class="col-md-3">

      </div>
    </div>

    <!-- Modal Escenario de grupo distribucion-->
    <div class="modal fade" id="agregagrupodistri" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">

      <div class="modal-dialog">

        <div class="modal-content">

          <div class="modal-header">

            <h4 class="modal-title" id="myModalLabel">Grupos de distribucion porcentual</h4>

            <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">×</span><span class="sr-only">Cerrar</span></button>

          </div>

          <div id="nuevaAventura" class="modal-body">

          <!--<div id="gridbox" style="width:300px;height:400px;"></div>-->
                 <table id="tablagrupodist"class="table table-hover table-primary">
                    <thead>
                      <tr>
                        <th>Nombre grupo</th>
                        <th>Detalle</th>
                        <th>Acción</th>
                    </tr>
                   </thead>
                    <tbody>
                      <tr>
                      <td>Ventas</td>
                      <td>grupo dist ventas</td>
                        <td> <button type="button" class="btn btn-danger" id="borragrupodist" onClick="myDeleteFunction(this);">Borrar</button></td>
                      </tr>
                      <tr>
                      <td>Soporte</td>
                      <td>grupo dist soporte</td>
                      <td> <button type="button" class="btn btn-danger" id="borragrupodist" onClick="myDeleteFunction(this);">Borrar</button></td>

                      </tr>
                      <tr>
                      <td>Bloqueos</td>
                      <td>grupo dist Bloqueo</td>
                      <td> <button type="button" class="btn btn-danger" id="borragrupodist" onClick="myDeleteFunction(this);">Borrar</button></td>

                      </tr>
                    </tbody>
                 </table>
          </div>

          <div class="modal-footer">

            <button type="button" class="btn btn-success" id="agregagrupodist" data-target="#agregagrup" data-toggle="modal" aria-haspopup="true" aria-expanded="false" >Agregar</button>



            <button type="button" class="btn btn-default" data-dismiss="modal">Cerrar</button>
          </div>
        </div>
      </div>
    </div>


    <!--modal agregagrupodistribucion-->
    <div class="modal fade" id="agregagrup" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">

      <div class="modal-dialog">

        <div class="modal-content">

          <div class="modal-header">

            <h4 class="modal-title" id="myModalLabel">Agregar grupo</h4>

            <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">×</span><span class="sr-only">Cerrar</span></button>

          </div>

          <div id="nuevaAventura" class="modal-body">

            <div class="input-group mb-3">
              <div class="input-group-prepend">
                  <span class="input-group-text" id="">Nombre</span>
              </div>
                <input id="input_nombre_horario" type="text" class="form-control" aria-label="Default" aria-describedby="inputGroup-sizing-default">
            </div>
            <div class="input-group mb-3">
              <div class="input-group-prepend">
                  <span class="input-group-text" id="">Detalle</span>
              </div>
                <input id="input_detalle_horario" type="text" class="form-control" aria-label="Default" aria-describedby="inputGroup-sizing-default">
            </div>
          </div>

          <div class="modal-footer">

            <button type="button" class="btn btn-success" id="agregagrupodist" onClick="myCreateFunction();">Agregar</button>
            <button type="button" class="btn btn-default" data-dismiss="modal">Cerrar</button>
          </div>
        </div>
      </div>
    </div>

  </div>


  <div id="scheduler_here" class="dhx_cal_container" style='width:100%; height:100%;'>
    <div class="dhx_cal_navline">

      <div class='dhx_cal_export pdf' id='export_pdf' title='Export to PDF' onclick='scheduler.toPDF("http://dhtmlxscheduler.appspot.com/export/pdf", "color")'>&nbsp;</div>
      <div class="dhx_cal_prev_button">&nbsp;</div>

      <div class="dhx_cal_next_button">&nbsp;</div>
      <div class="dhx_cal_today_button"></div>
      <div class="dhx_cal_date"></div>
      <div class="dhx_cal_tab" name="day_tab" style="right:204px;"></div>
      <div class="dhx_cal_tab" name="week_tab" style="right:140px;"></div>
      <div class="dhx_cal_tab" name="month_tab" style="right:76px;"></div>
      <div class="dhx_cal_tab" name="unit_tab" style="right:76px;"></div>
    </div>

    <div class="dhx_cal_header">
    </div>
    <div class="dhx_cal_data">
    </div>
  </div>

</body>

</html>
